<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>AI ‡∏´‡∏°‡∏≤‡∏Å‡∏Æ‡∏≠‡∏™ ‡πÑ‡∏£‡πâ‡∏û‡πà‡∏≤‡∏¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; text-align: center; background: #fafafa; }
    table { border-spacing: 0; margin: auto; }
    td {
      width: 40px; height: 40px;
      border: 1px solid #999;
      text-align: center;
      vertical-align: middle;
      font-size: 24px;
      cursor: pointer;
      position: relative;
    }
    .dark { background-color: #444; color: white; }
    .light { background-color: #eee; }
    .highlight {
      outline: 3px solid yellow;
    }
    .move-highlight {
      background-color: #6f9 !important;
      cursor: pointer;
    }
    button { margin: 8px; padding: 8px 20px; font-size: 16px; }
    #result { font-weight: bold; margin-top: 10px; }
    #count { margin-top: 5px; font-size: 14px; }
  </style>
</head>
<body onload="resetBoard()">
  <h2>‚ôüÔ∏è AI ‡∏´‡∏°‡∏≤‡∏Å‡∏Æ‡∏≠‡∏™: ‡πÇ‡∏´‡∏°‡∏î‡πÑ‡∏£‡πâ‡∏û‡πà‡∏≤‡∏¢</h2>
  <p>‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß: ‚ö™ ‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏≠‡∏á ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</p>
  <table id="board"></table>
  <div>
    <button onclick="aiAutoMove()">ü§ñ ‡πÉ‡∏´‡πâ AI ‡πÄ‡∏î‡∏¥‡∏ô (‡∏™‡∏µ‡∏î‡∏≥)</button>
    <button onclick="resetBoard()">‚ôªÔ∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
  </div>
  <p id="result"></p>
  <p id="count"></p>

<script>
let board = Array(8).fill().map(() => Array(8).fill(0));
let selectedPiece = null;    // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏´‡∏°‡∏≤‡∏Å‡∏Ç‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å [x,y]
let possibleMoves = [];      // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å

function renderBoard() {
  let html = "";
  let counts = {1:0,2:0,3:0,4:0};
  for (let y = 0; y < 8; y++) {
    html += "<tr>";
    for (let x = 0; x < 8; x++) {
      let c = (x + y) % 2 === 0 ? 'light' : 'dark';
      let p = board[y][x];
      let icon = p==1?'‚ö´':p==2?'‚ö™':p==3?'üîµ':p==4?'üü°':"";

      let classes = c;
      // ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå‡∏ä‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
      if(selectedPiece && selectedPiece[0] === x && selectedPiece[1] === y) {
        classes += " highlight";
      }
      // ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏î‡πâ
      if(possibleMoves.some(m => {
        let dest = m[m.length-1];
        return dest[0] === x && dest[1] === y;
      })) {
        classes += " move-highlight";
      }

      if (p>0) counts[p]++;
      html += `<td class="${classes}" onclick="cellClick(${x},${y})">${icon}</td>`;
    }
    html += "</tr>";
  }
  document.getElementById("board").innerHTML = html;
  document.getElementById("count").innerText = `‚ö´:${counts[1]} üîµ:${counts[3]} ‚ö™:${counts[2]} üü°:${counts[4]}`;
}

function resetBoard(){
  board = Array(8).fill().map(() => Array(8).fill(0));

  // ‡∏ß‡∏≤‡∏á‡∏´‡∏°‡∏≤‡∏Å‡∏Ç‡∏≤‡∏ß ‚ö™ (2) 2 ‡πÅ‡∏ñ‡∏ß‡∏ö‡∏ô (‡πÅ‡∏ñ‡∏ß 0-1) ‡∏ö‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡∏≥ (x+y) mod 2 ==1
  for (let y=0; y<=1; y++){
    for (let x=0; x<8; x++){
      if ((x + y) % 2 === 1) board[y][x] = 2;
    }
  }

  // ‡∏ß‡∏≤‡∏á‡∏´‡∏°‡∏≤‡∏Å‡∏î‡∏≥ ‚ö´ (1) 2 ‡πÅ‡∏ñ‡∏ß‡∏•‡πà‡∏≤‡∏á (‡πÅ‡∏ñ‡∏ß 6-7)
  for (let y=6; y<=7; y++){
    for (let x=0; x<8; x++){
      if ((x + y) % 2 === 1) board[y][x] = 1;
    }
  }

  selectedPiece = null;
  possibleMoves = [];
  renderBoard();
  document.getElementById("result").innerText = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°! ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß ‚ö™ ‡πÄ‡∏î‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô";
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏≤‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏ó‡∏≤‡∏á‡∏Å‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏°‡∏≤‡∏Å‡∏Ç‡∏≤‡∏ß‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
function getMultiJumpPaths(b,x,y,p,path=[[x,y]]){
  let out = [];
  let dirs = 
    (p == 1) ? [[-1,-1], [1,-1]] :       // ‚ö´ ‡πÄ‡∏î‡∏¥‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô
    (p == 2) ? [[-1,1], [1,1]] :         // ‚ö™ ‡πÄ‡∏î‡∏¥‡∏ô‡∏•‡∏á
    [[1,1],[1,-1],[-1,1],[-1,-1]];       // üîµ üü° ‡∏Æ‡∏≠‡∏ï‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ó‡∏≤‡∏á

  for (let [dx,dy] of dirs){
    let cx=x+dx, cy=y+dy;
    while (cx+dx>=0&&cx+dx<8&&cy+dy>=0&&cy+dy<8){
      let t = b[cy][cx];
      if ((p==1||p==3)&&(t==2||t==4) || (p==2||p==4)&&(t==1||t==3)){
        let lx=cx+dx, ly=cy+dy;
        if (b[ly][lx]==0){
          let newBoard = simulateMove([...path,[lx,ly]],b);
          let next = getMultiJumpPaths(newBoard,lx,ly,p,[...path,[lx,ly]]);
          if (next.length) out.push(...next);
          else out.push([...path,[lx,ly]]);
        }
        break;
      }
      if (t!=0 || p<3) break;
      cx+=dx; cy+=dy;
    }
  }
  return out;
}

function getMoves(b,player){
  let jumps=[], normal=[];
  for (let y=0;y<8;y++){
    for (let x=0;x<8;x++){
      let p = b[y][x];
      if ((player==1&&(p==1||p==3))||(player==2&&(p==2||p==4))){
        let jps = getMultiJumpPaths(b,x,y,p);
        if (jps.length) jumps.push(...jps);
        else {
          let dirs = [[1,1],[1,-1],[-1,1],[-1,-1]];
          for (let [dx,dy] of dirs){
            let nx=x+dx, ny=y+dy;
            if (nx>=0&&nx<8&&ny>=0&&ny<8&&b[ny][nx]==0){
              if ((p==1 && dy==-1) || (p==2 && dy==1) || (p>=3)) {
                normal.push([[x,y],[nx,ny]]);
              }
            }
          }
        }
      }
    }
  }
  return jumps.length?jumps:normal;
}

function simulateMove(move, inputBoard=board){
  let b = inputBoard.map(r => [...r]);
  let [sx,sy] = move[0], p = b[sy][sx];
  b[sy][sx] = 0;
  for (let i=1;i<move.length;i++){
    let [x,y] = move[i], [px,py] = move[i-1];
    let dx=Math.sign(x-px), dy=Math.sign(y-py);
    let cx=px+dx, cy=py+dy;
    while (cx!=x && cy!=y){
      if (b[cy][cx]!=0){ b[cy][cx]=0; break; }
      cx+=dx; cy+=dy;
    }
  }
  let [ex,ey] = move[move.length-1];
  if (p==1 && ey==0) p=3; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Æ‡∏≠‡∏ï (King)
  else if (p==2 && ey==7) p=4;
  b[ey][ex] = p;
  return b;
}

function evaluate(b){
  let score = 0;
  for (let y=0; y<8; y++){
    for (let x=0; x<8; x++){
      let p = b[y][x];
      let isCenter = (x >= 2 && x <= 5 && y >= 2 && y <= 5);
      let isEdge = (x == 0 || x == 7 || y == 0 || y == 7);
      if (p == 1) score += 5 + (isCenter ? 0.5 : 0) - (isEdge ? 0.3 : 0);
      else if (p == 3) score += 10 + (isCenter ? 1 : 0);
      else if (p == 2) score -= 4.5 + (isCenter ? 0.5 : 0) - (isEdge ? 0.3 : 0);
      else if (p == 4) score -= 9 + (isCenter ? 1 : 0);
    }
  }
  return score;
}

function minimax(b,depth,max,alpha=-9999,beta=9999){
  if (depth==0) return [evaluate(b),null];
  let moves = getMoves(b,max?1:2);
  if (!moves.length) return [evaluate(b),null];
  let best=max?-9999:9999, bestMove=null;
  for (let m of moves){
    let next = simulateMove(m,b);
    let [val] = minimax(next,depth-1,!max,alpha,beta);
    if (max && val>best){ best=val; bestMove=m; alpha=Math.max(alpha,val); }
    if (!max && val<best){ best=val; bestMove=m; beta=Math.min(beta,val); }
    if (beta<=alpha) break;
  }
  return [best,bestMove];
}

function aiAutoMove(){
  let [score, move] = minimax(board, 7, true); // AI ‡∏ù‡∏±‡πà‡∏á‡∏î‡∏≥
  if (!move) {
    document.getElementById("result").innerText = "‚ùå AI ‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞!";
    return;
  }
  board = simulateMove(move);
  renderBoard();
  document.getElementById("result").innerText = `ü§ñ AI ‡πÄ‡∏î‡∏¥‡∏ô: ${move.map(([x,y]) => `(${x},${y})`).join(" ‚Üí ")}`;
  selectedPiece = null;
  possibleMoves = [];
}

// --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô (‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏≤‡∏ß) ---

function cellClick(x,y) {
  let p = board[y][x];
  // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ ‡πÉ‡∏´‡πâ‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏°‡∏≤‡∏Å‡∏Ç‡∏≤‡∏ß
  if (possibleMoves.length > 0 && possibleMoves.some(m => {
    let dest = m[m.length-1];
    return dest[0] === x && dest[1] === y;
  })) {
    // ‡∏´‡∏≤ move ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    let move = possibleMoves.find(m => {
      let dest = m[m.length-1];
      return dest[0] === x && dest[1] === y;
    });
    if(move) {
      board = simulateMove(move);
      renderBoard();
      document.getElementById("result").innerText = `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏î‡∏¥‡∏ô: ${move.map(([x,y]) => `(${x},${y})`).join(" ‚Üí ")}`;
      selectedPiece = null;
      possibleMoves = [];

      // ‡πÉ‡∏´‡πâ AI ‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡πà‡∏≠
      setTimeout(() => {
        aiAutoMove();
      }, 200);
    }
    return;
  }

  // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏°‡∏≤‡∏Å‡∏Ç‡∏≤‡∏ß ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
  if (p === 2 || p === 4) {
    selectedPiece = [x,y];
    possibleMoves = getMultiJumpPaths(board,x,y,p);
    if (possibleMoves.length === 0) {
      // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏≤‡∏á‡∏Å‡∏¥‡∏ô -> ‡∏´‡∏≤‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤
      let normalMoves = [];
      let dirs = [[1,1],[1,-1],[-1,1],[-1,-1]];
      for (let [dx,dy] of dirs) {
        let nx = x + dx;
        let ny = y + dy;
        if (nx>=0 && nx<8 && ny>=0 && ny<8 && board[ny][nx] === 0) {
          if ((p === 2 && dy === 1) || p >= 3) { // ‡∏Ç‡∏≤‡∏ß‡πÄ‡∏î‡∏¥‡∏ô‡∏•‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏Æ‡∏≠‡∏ï‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ó‡∏≤‡∏á
            normalMoves.push([[x,y],[nx,ny]]);
          }
        }
      }
      possibleMoves = normalMoves;
    }
    renderBoard();
  } else {
    // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    selectedPiece = null;
    possibleMoves = [];
    renderBoard();
  }
}

</script>
</body>
</html>